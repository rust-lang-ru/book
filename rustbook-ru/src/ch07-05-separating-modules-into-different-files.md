## Разделение разделов на разные файлы

До сих пор все примеры в этой главе определяли несколько разделов в одном файле. Когда разделы становятся большими, вы можете захотеть переместить их содержимое в отдельные файлы, чтобы упростить поиск по рукописи.

Например, давайте начнём с рукописи из приложения 7-17, в котором было несколько разделов ресторана. Мы будем извлекать разделы в файлы вместо того, чтобы определять их все в одном корневом разделе ящика. В нашем случае корневой раздел ящика - *src/lib.rs*, но это разделение также работает и с исполняемыми ящиками, у которых корневой раздел ящика — *src/main.rs*.

Сначала мы извлечём раздел `перед_дома` в свой собственный файл. Удалите рукопись внутри узорчатых скобок для раздела `перед_дома`, оставив только объявление `mod перед_дома;`, так что теперь *src/lib.rs* содержит рукопись, показанную в приложении 7-21. Обратите внимание, что этот исход не собирается, пока мы не создадим файл *src/перед_дома.rs* из приложения 7-22.

<span class="filename">Файл: src/lib.rs</span>

```rust,ignore,does_not_compile
{{#rustdoc_include ../listings/ch07-managing-growing-projects/listing-07-21-and-22/src/lib.rs}}
```

<span class="caption">Приложение 7-21: Объявление раздела <code>перед_дома</code>, чьё содержимое будет в <em>src/перед_дома.rs</em></span>

Затем поместим рукопись, которая была в узорчатых скобках, в новый файл с именем *src/перед_дома.rs*, как показано в приложении 7-22. Сборщик знает, что нужно искать в этом файле, потому что он наткнулся в корневом разделе ящика на объявление раздела с именем `перед_дома`.

<span class="filename">Файл: src/перед_дома.rs</span>

```rust,ignore
{{#rustdoc_include ../listings/ch07-managing-growing-projects/listing-07-21-and-22/src/front_of_house.rs}}
```

<span class="caption">Приложение 7-22. Определение содержимого раздела <code>перед_дома</code> в файле <em>src/перед_дома.rs</em></span>

Обратите внимание, что вам нужно только *один раз* загрузить файл с помощью объявления `mod` в вашем дереве разделов. Как только сборщик узнает, что файл является частью приложения (и узнает, где в дереве разделов находится рукопись, поскольку вы поместили указание  `mod`), другие файлы в вашем деле должны ссылаться на рукопись загруженного файла, используя путь к месту, где он был объявлен, как описано в разделе [«Пути для ссылки на переменную в дереве разделов»]<!-- ignore -->. Другими словами, `mod` — это *не* действие «включения», которое вы могли видеть в других языках программирования.

Далее мы извлечём раздел `hosting` в его собственный файл. Этап немного отличается, потому что `hosting` является дочерним разделом для `перед_дома`, а не корневого раздела. Мы поместим файл для `hosting` в новую папку, который будет назван по имени его предка в дереве разделов, в данном случае это *src/перед_дома/*.

Чтобы начать перенос `hosting`, мы меняем *src/перед_дома.rs* так, чтобы он содержал только объявление раздела `hosting`:

<span class="filename">Файл: src/перед_дома.rs</span>

```rust,ignore
{{#rustdoc_include ../listings/ch07-managing-growing-projects/no-listing-02-extracting-hosting/src/front_of_house.rs}}
```

Затем мы создаём папку *src/перед_дома* и файл *hosting.rs*, в котором будут  определения, сделанные в разделе `hosting`:

<span class="filename">Файл: src/перед_дома/hosting.rs</span>

```rust,ignore
{{#rustdoc_include ../listings/ch07-managing-growing-projects/no-listing-02-extracting-hosting/src/front_of_house/hosting.rs}}
```

Если вместо этого мы поместим *hosting.rs* в папку *src*, сборщик будет думать, что рукопись в *hosting.rs* это раздел `hosting`, объявленный в корне ящика, а не объявленный как дочерний раздел `перед_дома`. Правила сборщика для проверки: какие файлы содержат рукопись каких разделов предполагают, что папки и файлы точно соответствуют дереву разделов.

> ### Иные пути к файлам
>
> До сих пор мы рассматривали наиболее привычные пути к файлам, используемые сборщиком Ржавчины, но Ржавчина также поддерживает и старое исполнение пути к файлу. Для раздела с именем `перед_дома`, объявленного в корневом разделе ящика, сборщик будет искать рукопись раздела в:
>
> - *src/перед_дома.rs* (что мы рассматривали)
> - *src/перед_дома/mod.rs* (старое исполнение, всё ещё поддерживаемый путь)
>
> Для раздела с именем `hosting`, который является подразделом `перед_дома`, сборщик будет искать рукопись раздела в:
>
> - *src/перед_дома/hosting.rs* (что мы рассматривали)
> - *src/перед_дома/hosting/mod.rs* (старое исполнение, всё ещё поддерживаемый путь)
>
> Если вы используете оба исполнения для одного и того же раздела, вы получите ошибку сборщика. Использование сочетания обоих исполнений для разных разделов в одном деле разрешено, но это может сбивать с толку людей, перемещающихся по вашему делу.
>
> Основным недостатком исполнения, в котором используются файлы с именами *mod.rs*, является то, что в вашем деле может оказаться много файлов с именами *mod.rs*, что может привести к путанице, если вы одновременно откроете их в редакторе.

Мы перенесли рукопись каждого раздела в отдельный файл, а дерево разделов осталось прежним. Вызовы способов (функций) в `поесть_в_ресторане` будут работать без каких-либо изменений, несмотря на то, что определения находятся в разных файлах. Этот способ позволяет перемещать разделы в новые файлы по мере увеличения их размеров.

Обратите внимание, что указание `pub use crate::перед_дома::hosting` в *src/lib.rs* также не изменилось, и `use` не влияет на то, какие файлы собираются как часть ящика. Ключевое слово `mod` объявляет разделы, и Ржавчина ищет в файле с тем же именем, что и у раздела, рукопись, которая входит в это раздел.

## Итог

Ржавчина позволяет разбить дополнение на несколько ящиков, а сам ящик - на разделы, так что вы можете ссылаться на переменную, определённые в одном разделе (файле), из другого раздела (файла). Это можно делать при помощи указания безусловных или относительных путей. Эти *пути* можно добавить в область видимости указанием `use`, поэтому вы можете пользоваться более короткими путями для многократного использования содержимого в этой области видимости. Рукопись раздела по умолчанию является закрытой, но можно сделать его содержимое - способы (функции), определения, виды данных и т.д. общедоступными, добавив ключевое слово `pub`.

В следующей главе мы рассмотрим некоторые виды данных - собрания из встроенной библиотеки, которые вы можете использовать в своей правильно составленной рукописи.


[«Пути для ссылки на переменную в дереве разделов»]: ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html