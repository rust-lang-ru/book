## Приложение Ж - Как создаётся Ржавчина и “Ночное издание Ржавчины”

Это дополнение рассказывает как создаётся Ржавчина, и как это влияет на Вас как на разработчика.

### Безотказность без застоя

Как язык, Ржавчина *очень сильно* заботиться о безотказности работы вашей рукописи. Мы хотим чтобы Ржавчина была прочной основой, вашей опорой, и если бы все постоянно менялось, это было бы невозможно. В то же время, если мы не можем проводить опыты с различными возможностями, мы не можем обнаружить важные сбои до исполнения, когда мы не можем их изменить.

Нашим решением возникновения сбоев является “безотказность без застоя”, и наш руководящий принцип: Вы никогда не должны бояться перехода на новую безотказное исполнение Ржавчины. Каждое обновление должно быть безболезненным, но также должно добавлять новые способы (функции), меньше дефектов и более быструю скорость сборки.

### Ту-ту! потоки выпуска и поездка на поезде

Разработка языка Ржавчина работает по принципу *расписания поездов*. То есть, вся разработка совершается в ветке `master` Ржавчина хранилища. Выпуски следуют подходы последовательного выпуска продукта (software release train), которая была использована Cisco IOS и другими программными продуктами. Есть три *потока выпуска* Ржавчина:

- Ночной (Nightly)
- Бета (Beta)
- Безотказное (Stable)

Большинство Ржавчина разработчиков используют безотказное исполнение, но те кто хотят попробовать предварительные  новые способы (функции), должны использовать Nightly или Beta.

Приведём пример, как работает этап разработки и выпуска новых исполнений. Давайте предположим, что объединение Ржавчина работает над исполнением Ржавчина 1.5. Его исполнение состоялся в декабре 2015 года, но это даст достоверный номера исполнения. Была добавлена новая возможность в Ржавчине: новые изменения в ветку `master`. Каждую ночь выпускается новая ночная исполнение Ржавчины. Каждый день является днём выпуска ночного исполнения и эти выпуски создаются нашим устройством самостоятельно . По мере того как идёт время, наши выпуски выглядят так:

```text
nightly: * - - * - - *
```

Каждые шесть недель наступает время подготовки новой Beta исполнения! Ветка `beta` Ржавчина хранилища ответвляется от ветки `master`, используемой исполнением Nightly. Теперь мы имеем два выпуска:

```text
nightly: * - - * - - *
                     |
beta:                *
```

Многие пользователи Ржавчины не используют постоянно бета-исполнение, но проверяют бета-исполнение в их системе CI для помощи Ржавчине обнаружить сбои обратной совместимости. В это время каждую ночь выпускается новое исполнение Nightly:

```text
nightly: * - - * - - * - - * - - *
                     |
beta:                *
```

Предположим, что была найдена отступление. Хорошо, что мы можем проверять бета-исполнение перед тем как отступление попала в безотказное исполнение! Исправление отправляется в ветку `master`, поэтому исполнение nightly исправлена и затем исправление также направляется в ветку `beta`, и происходит новый выпуск бета-исполнения:

```text
nightly: * - - * - - * - - * - - * - - *
                     |
beta:                * - - - - - - - - *
```

Через шесть недель после выпуска бета-исполнения, наступает время для выпуска безотказного исполнения! Ветка `stable` создаётся из ветки `beta`:

```text
nightly: * - - * - - * - - * - - * - - * - * - *
                     |
beta:                * - - - - - - - - *
                                       |
stable:                                *
```

Ура! Ржавчина 1.5 выпущена! Но мы также забыли про одну вещь: так как прошло шесть недель, мы должны выпустить бета-исполнение *следующей*  исполнения Ржавчины 1.6. Поэтому после ответвления ветки `stable` из ветки `beta`, следующая исполнение `beta` ответвляется снова от `nightly`:

```text
nightly: * - - * - - * - - * - - * - - * - * - *
                     |                         |
beta:                * - - - - - - - - *       *
                                       |
stable:                                *
```

Это называется “прообраз поезда” (train model), потому что каждые шесть недель выпуск “покидает станцию”, но ему все ещё нужно пройти поток beta, чтобы попасть в безотказное исполнение.

Ржавчина выпускается каждые шесть недель, как часы. Если вы знаете дату одного выпуска Ржавчина, вы знаете дату выпуска следующего: это шесть недель позднее. Хорошей особенностью выпуска исполнений каждые шесть недель является то, что следующий поезд прибывает скоро. Если какая-то способ (функция) не попадает в исполнение, не надо волноваться: ещё один выпуск произойдёт очень скоро! Это помогает снизить давление в случае если способ (функция) возможно не отполирована к дате выпуска.

Благодаря этому этапу, вы всегда можете посмотреть следующую исполнение Ржавчины и убедиться, что на неё легко будет перейти: если бета-выпуск будет работать не так как ожидалось, вы можете сообщить об этом разработчикам и он будет исправлен перед выпуском безотказного исполнения! Поломки в бета-исполнения случаются относительно редко, но `rustc` все ещё является частью программного обеспечения, поэтому дефекты все ещё существуют.

### Ненадежные способы (функции)

У этого подхода выпуска есть ещё одно достоинство: ненадежные способы (функции). Ржавчина использует средство называемое “клейма возможностей” (feature flags) для определения функций, которые были включены в выпуске. Если новая способ (функция) находится в усиленной разработке, она попадает в ветку `master`, и поэтому попадает в ночное исполнение, но с *клеймом способы (функции)* (feature flag). Если как пользователь, вы хотите попробовать работу такой способы (функции), находящейся в разработке, вы должны использовать ночное исполнение Ржавчины и указать в вашем исходной рукописи определённый клеймо.

Если вы используете бета или безотказное исполнение Ржавчины, Вы не можете использовать клейма функций. Это ключевое мгновение позволяет использовать в действительности новые возможности перед их отладкой. Это может использоваться желающими идти в ногу со временем, а другие могут использовать безотказное исполнение и быть уверенными что их рукопись не сломается. Безотказность без застоя.

Эта книга содержит сведения только о безотказных возможностях, так как разрабатываемые возможности продолжают меняться в этапе и несомненно они будут отличаться в зависимости от того, когда эта книга написана и когда эти возможности будут включены в безотказные сборки. Вы можете найти сведения о возможностях ночного исполнения в мировой сети.

### Rustup и значение ночного исполнения Ржавчины

Rustup делает лёгким изменение между различными потоками Ржавчина, на вездесущем или своём для приложения уровне. По умолчанию устанавливается безотказное исполнение Ржавчины. Для установки ночного исполнения выполните приказ:

```console
$ rustup toolchain install nightly
```

Вы можете также увидеть все установленные *средства разработчика (toolchains)* (исполнения Ржавчины и сопряженные составляющие) с помощью `rustup`. Это пример вывода у одного из составителей Ржавчина с компьютером на Windows:

```powershell
> rustup toolchain list
stable-x86_64-pc-windows-msvc (default)
beta-x86_64-pc-windows-msvc
nightly-x86_64-pc-windows-msvc
```

Как видите, включенный набор средств (toolchain) используется по умолчанию. Большинство пользователей Ржавчина используют безотказные исполнения большую часть времени. Возможно, вы захотите использовать безотказную большую часть времени, но использовать каждую ночное исполнение в определенном деле, потому что заботитесь о передовых возможностях. Для этого вы можете использовать приказ `rustup override` в папке этого приложения, чтобы установить ночной набор средств, должна использоваться приказ `rustup`, когда вы находитесь в этом папке:

```console
$ cd ~/projects/needs-nightly
$ rustup override set nightly
```

Теперь каждый раз, когда вы вызываете `rustc` или `cargo` внутри *~/projects/needs-nightly*, `rustup` будет следить за тем, чтобы вы используете ночное исполнение Ржавчины, а не безотказную по умолчанию. Это очень удобно, когда у вас есть множество Ржавчина дел!

### Этап RFC и приказы

Итак, как вы узнаете об этих новых возможностях? Прообраз разработки Ржавчина следует *этапу запроса примечаний (RFC - Request For Comments)*. Если хотите улучшить Ржавчина, вы можете написать предложение, которое называется RFC.

Любой может написать RFC для улучшения Ржавчины. Предложения рассматриваются и обсуждаются объединением Ржавчина, которое состоит из множества связанных между собой общностей и общин. На [сайте Ржавчины в сети](https://www.rust-lang.org/governance) есть полный список приказов, который включает приказы для каждой области дела: внешний вид языка, использование сборщика, инфраустройства, пособие и многое другое. Соответствующий приказ считывает предложение и примечания, пишет некоторые собственные примечания и в конечном итоге, приходит к выводу принять или отклонить эту возможность.

Если новая возможность принята и кто-то может использовать её, то задача открывается в хранилища Ржавчина. Человек выполняющий её, вполне может не быть тем, кто предложил эту возможность! Когда исполнение готово, оно попадает в `master` ветвь с клеймом способы (функции), как мы обсуждали в разделе ["Небезотказных функциях"](#unstable-features)<!--  -->.

Через некоторое время, разработчики Ржавчина использующие ночные выпуски, смогут опробовать новую возможность, участники сообщества обсудят её, как она работает в ночном исполнении и решат, должна ли она попасть в безотказное исполнение Ржавчины или нет. Если принимается решение двигать её вперёд, ограничение способы (функции) с помощью клейма убирается и способ (функция) теперь считается безотказной! Она едет в новое  безотказное исполнение Ржавчины.
